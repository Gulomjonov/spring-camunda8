<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:zeebe="http://camunda.org/schema/zeebe/1.0"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  id="Definitions_1"
                  targetNamespace="http://bpmn.io/schema/bpmn"
                  exporter="Camunda Modeler"
                  exporterVersion="5.40.0">

    <bpmn:process id="application-process" isExecutable="true">

        <!-- Start Event -->
        <bpmn:startEvent id="start-event" name="Application Received">
            <bpmn:outgoing>Flow_1</bpmn:outgoing>
        </bpmn:startEvent>

        <!-- Log Process Start -->
        <bpmn:serviceTask id="log-process-start" name="Log Process Start">
            <bpmn:extensionElements>
                <zeebe:taskDefinition type="log-process-start" />
            </bpmn:extensionElements>
            <bpmn:incoming>Flow_1</bpmn:incoming>
            <bpmn:outgoing>Flow_2</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_1" sourceRef="start-event" targetRef="log-process-start" />

        <!-- Check Client Status -->
        <bpmn:serviceTask id="check-client-status" name="Check Client Status">
            <bpmn:extensionElements>
                <zeebe:taskDefinition type="check-client-status" />
            </bpmn:extensionElements>
            <bpmn:incoming>Flow_2</bpmn:incoming>
            <bpmn:outgoing>Flow_3</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_2" sourceRef="log-process-start" targetRef="check-client-status" />

        <!-- Exclusive Gateway for Status Check -->
        <bpmn:exclusiveGateway id="status-gateway" name="Status Check" default="Flow_FAILED">
            <bpmn:incoming>Flow_3</bpmn:incoming>
            <bpmn:outgoing>Flow_SUCCESS</bpmn:outgoing>
            <bpmn:outgoing>Flow_APPROVED</bpmn:outgoing>
            <bpmn:outgoing>Flow_REJECTED</bpmn:outgoing>
            <bpmn:outgoing>Flow_FAILED</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_3" sourceRef="check-client-status" targetRef="status-gateway" />

        <!-- Gateway outgoing flows with conditions -->
        <bpmn:sequenceFlow id="Flow_SUCCESS" sourceRef="status-gateway" targetRef="log-success">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" language="feel"><![CDATA[clientStatus = "SUCCESS"]]></bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="Flow_APPROVED" sourceRef="status-gateway" targetRef="log-success">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" language="feel"><![CDATA[clientStatus = "APPROVED"]]></bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="Flow_REJECTED" sourceRef="status-gateway" targetRef="log-failure">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" language="feel"><![CDATA[clientStatus = "REJECTED"]]></bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="Flow_FAILED" sourceRef="status-gateway" targetRef="log-failure" />

        <!-- Log Success -->
        <bpmn:serviceTask id="log-success" name="Log Success">
            <bpmn:extensionElements>
                <zeebe:taskDefinition type="log-success" />
            </bpmn:extensionElements>
            <bpmn:incoming>Flow_SUCCESS</bpmn:incoming>
            <bpmn:incoming>Flow_APPROVED</bpmn:incoming>
            <bpmn:outgoing>Flow_success-end</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_success-end" sourceRef="log-success" targetRef="success-end" />

        <!-- Log Failure -->
        <bpmn:serviceTask id="log-failure" name="Log Failure">
            <bpmn:extensionElements>
                <zeebe:taskDefinition type="log-failure" />
            </bpmn:extensionElements>
            <bpmn:incoming>Flow_REJECTED</bpmn:incoming>
            <bpmn:incoming>Flow_FAILED</bpmn:incoming>
            <bpmn:outgoing>Flow_failure-end</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_failure-end" sourceRef="log-failure" targetRef="failure-end" />

        <!-- End Events -->
        <bpmn:endEvent id="success-end" name="Application Approved">
            <bpmn:incoming>Flow_success-end</bpmn:incoming>
        </bpmn:endEvent>
        <bpmn:endEvent id="failure-end" name="Application Rejected">
            <bpmn:incoming>Flow_failure-end</bpmn:incoming>
        </bpmn:endEvent>

    </bpmn:process>

    <!-- BPMN Diagram info -->
    <bpmndi:BPMNDiagram id="BPMNDiagram_1">
        <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="application-process">
            <bpmndi:BPMNShape id="StartEvent_1" bpmnElement="start-event">
                <dc:Bounds x="150" y="100" width="36" height="36" />
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape id="ServiceTask_1" bpmnElement="log-process-start">
                <dc:Bounds x="250" y="80" width="100" height="80" />
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape id="ServiceTask_2" bpmnElement="check-client-status">
                <dc:Bounds x="400" y="80" width="100" height="80" />
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape id="ExclusiveGateway_1" bpmnElement="status-gateway" isMarkerVisible="true">
                <dc:Bounds x="570" y="95" width="50" height="50" />
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape id="ServiceTask_3" bpmnElement="log-success">
                <dc:Bounds x="690" y="50" width="100" height="80" />
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape id="ServiceTask_4" bpmnElement="log-failure">
                <dc:Bounds x="690" y="180" width="100" height="80" />
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape id="EndEvent_1" bpmnElement="success-end">
                <dc:Bounds x="830" y="65" width="36" height="36" />
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape id="EndEvent_2" bpmnElement="failure-end">
                <dc:Bounds x="830" y="200" width="36" height="36" />
            </bpmndi:BPMNShape>
        </bpmndi:BPMNPlane>
    </bpmndi:BPMNDiagram>

</bpmn:definitions>
